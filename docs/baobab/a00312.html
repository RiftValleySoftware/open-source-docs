<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BAOBAB: CO_Main_Data_DB Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BAOBAB
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00312.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="a00309.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CO_Main_Data_DB Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for CO_Main_Data_DB:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00311.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Collaboration diagram for CO_Main_Data_DB:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00310.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3a2aaf7151bd7cfe8eeffafe34e030d9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a3a2aaf7151bd7cfe8eeffafe34e030d9">__construct</a> ( $in_pdo_object, $in_access_object=NULL)</td></tr>
<tr class="separator:a3a2aaf7151bd7cfe8eeffafe34e030d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad50ae8e57d81015ec1e8601dd2eaba4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#aad50ae8e57d81015ec1e8601dd2eaba4">item_exists</a> ( $in_id, $in_visibility_test=false)</td></tr>
<tr class="separator:aad50ae8e57d81015ec1e8601dd2eaba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5f95b226e01879bbee99a65b33cb12b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#ad5f95b226e01879bbee99a65b33cb12b">get_all_visible_users</a> ()</td></tr>
<tr class="separator:ad5f95b226e01879bbee99a65b33cb12b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab72e9d50a3ba59e898ac589bd0ca9efd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#ab72e9d50a3ba59e898ac589bd0ca9efd">see_if_user_exists</a> ( $in_login_id)</td></tr>
<tr class="separator:ab72e9d50a3ba59e898ac589bd0ca9efd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10fdab7b5236d7f970f54ebc19a1862c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a10fdab7b5236d7f970f54ebc19a1862c">tag0_is_unique</a> ( $in_tag0, $in_classname='<a class="el" href="a00252.html">CO_KeyValue_CO_Collection</a>')</td></tr>
<tr class="separator:a10fdab7b5236d7f970f54ebc19a1862c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a303048d406814c066d27fda70de4ff02"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a303048d406814c066d27fda70de4ff02">generic_search</a> ( $in_search_parameters=NULL, $or_search=false, $page_size=0, $initial_page=0, $and_writeable=false, $count_only=false, $ids_only=false)</td></tr>
<tr class="separator:a303048d406814c066d27fda70de4ff02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_a00304"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_a00304')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="a00304.html">A_CO_DB</a></td></tr>
<tr class="memitem:a523e2f40174a0bca0fc873d6286b3ae9 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a523e2f40174a0bca0fc873d6286b3ae9">_instantiate_record</a> ( $in_db_result)</td></tr>
<tr class="separator:a523e2f40174a0bca0fc873d6286b3ae9 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2396849660aa4ff018ab7509a4badeb5 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a2396849660aa4ff018ab7509a4badeb5">execute_query</a> ( $in_sql, $in_parameters=NULL, $exec_only=false)</td></tr>
<tr class="separator:a2396849660aa4ff018ab7509a4badeb5 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b86c0613b521ffdbbd62f8928ad07f8 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a4b86c0613b521ffdbbd62f8928ad07f8">get_db_backup</a> ()</td></tr>
<tr class="separator:a4b86c0613b521ffdbbd62f8928ad07f8 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a707e7cfdbea32a3713320dbca46dac64 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a707e7cfdbea32a3713320dbca46dac64">get_access_class_by_id</a> ( $in_id)</td></tr>
<tr class="separator:a707e7cfdbea32a3713320dbca46dac64 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6baed01812f38acbc19df4b00f443b2 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#af6baed01812f38acbc19df4b00f443b2">can_i_see_this_record</a> ( $in_id)</td></tr>
<tr class="separator:af6baed01812f38acbc19df4b00f443b2 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af62a0d273b69bdf1f5012f88e619cec7 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#af62a0d273b69bdf1f5012f88e619cec7">get_single_raw_row_by_id</a> ( $in_id, $and_write=false)</td></tr>
<tr class="separator:af62a0d273b69bdf1f5012f88e619cec7 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a631d8d027d72c940a7cec689cbb4e568 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a631d8d027d72c940a7cec689cbb4e568">get_single_record_by_id</a> ( $in_id, $and_write=false)</td></tr>
<tr class="separator:a631d8d027d72c940a7cec689cbb4e568 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaca8bf49257aa5ade3c354ef76119fa4 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#aaca8bf49257aa5ade3c354ef76119fa4">get_multiple_records_by_id</a> ( $in_id_array, $and_write=false)</td></tr>
<tr class="separator:aaca8bf49257aa5ade3c354ef76119fa4 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ccca3e1b18f58a3d4a4ad6018f067b1 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a6ccca3e1b18f58a3d4a4ad6018f067b1">get_all_readable_records</a> ( $open_only=false, $in_this_id=NULL)</td></tr>
<tr class="separator:a6ccca3e1b18f58a3d4a4ad6018f067b1 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b39eabcd72a9d79267e51a5f2b16648 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a2b39eabcd72a9d79267e51a5f2b16648">get_all_writeable_records</a> ( $in_this_id=NULL)</td></tr>
<tr class="separator:a2b39eabcd72a9d79267e51a5f2b16648 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afacdcd578ddc750ca33d2418b54ab6b9 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#afacdcd578ddc750ca33d2418b54ab6b9">lock_record</a> ( $in_record_id)</td></tr>
<tr class="separator:afacdcd578ddc750ca33d2418b54ab6b9 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac7eadbd231d714f3eed150eec35838 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#acac7eadbd231d714f3eed150eec35838">write_record</a> ( $params_associative_array)</td></tr>
<tr class="separator:acac7eadbd231d714f3eed150eec35838 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9794f1140b379f8d09c4265a089fcea0 inherit pub_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a9794f1140b379f8d09c4265a089fcea0">delete_record</a> ( $id)</td></tr>
<tr class="separator:a9794f1140b379f8d09c4265a089fcea0 inherit pub_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ae11526b802f2277322e001bc2d45094b"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#ae11526b802f2277322e001bc2d45094b">get_accurate_distance</a> ( $lat1, $lon1, $lat2, $lon2)</td></tr>
<tr class="memdesc:ae11526b802f2277322e001bc2d45094b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Uses the Vincenty calculation to determine the distance (in Kilometers) between the two given lat/long pairs (in Degrees).  <a href="a00312.html#ae11526b802f2277322e001bc2d45094b">More...</a><br /></td></tr>
<tr class="separator:ae11526b802f2277322e001bc2d45094b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a352444b4bfd455cb53a57137f3c44884"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a352444b4bfd455cb53a57137f3c44884">_location_predicate</a> ( $in_longitude, $in_latitude, $in_radius_in_km, $and_writeable=false, $count_only=false)</td></tr>
<tr class="separator:a352444b4bfd455cb53a57137f3c44884"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49c326f37d274ac9f25171380c851164"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a49c326f37d274ac9f25171380c851164">_parse_tags</a> ( $in_value)</td></tr>
<tr class="separator:a49c326f37d274ac9f25171380c851164"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a884b5749acdbc87467741bc6610794e4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a884b5749acdbc87467741bc6610794e4">_parse_integer_parameter</a> ( $in_db_key, $in_value)</td></tr>
<tr class="separator:a884b5749acdbc87467741bc6610794e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46a9af2d7f6fc1388608022c6b84662e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a46a9af2d7f6fc1388608022c6b84662e">_parse_string_parameter</a> ( $in_db_key, $in_value)</td></tr>
<tr class="separator:a46a9af2d7f6fc1388608022c6b84662e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64a118564e4da8a3b0220ee5cf088e9b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#a64a118564e4da8a3b0220ee5cf088e9b">_parse_parameters</a> ( $in_search_parameters=NULL, $or_search=false)</td></tr>
<tr class="separator:a64a118564e4da8a3b0220ee5cf088e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa97e6ad521aed4c2cbe03e83017af0b7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00312.html#aa97e6ad521aed4c2cbe03e83017af0b7">_build_sql_query</a> ( $in_search_parameters=NULL, $or_search=false, $page_size=0, $initial_page=0, $and_writeable=false, $count_only=false, $ids_only=false)</td></tr>
<tr class="separator:aa97e6ad521aed4c2cbe03e83017af0b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_a00304"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_a00304')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="a00304.html">A_CO_DB</a></td></tr>
<tr class="memitem:a176b2c663fa7768e95e4fbe93281adc6 inherit pro_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a176b2c663fa7768e95e4fbe93281adc6">_create_read_security_predicate</a> ()</td></tr>
<tr class="separator:a176b2c663fa7768e95e4fbe93281adc6 inherit pro_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4bc3d416f085818935b32a814313202 inherit pro_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#ad4bc3d416f085818935b32a814313202">_create_write_security_predicate</a> ()</td></tr>
<tr class="separator:ad4bc3d416f085818935b32a814313202 inherit pro_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2356dbed1b38898d8c17bcd8eb405ef inherit pro_methods_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#ad2356dbed1b38898d8c17bcd8eb405ef">_create_security_predicate</a> ( $write=false)</td></tr>
<tr class="separator:ad2356dbed1b38898d8c17bcd8eb405ef inherit pro_methods_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_attribs_a00304"><td colspan="2" onclick="javascript:toggleInherit('pub_attribs_a00304')"><img src="closed.png" alt="-"/>&#160;Public Attributes inherited from <a class="el" href="a00304.html">A_CO_DB</a></td></tr>
<tr class="memitem:a83fd5822487fa194ff0b617d90d747fc inherit pub_attribs_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a83fd5822487fa194ff0b617d90d747fc">$access_object</a></td></tr>
<tr class="separator:a83fd5822487fa194ff0b617d90d747fc inherit pub_attribs_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad57301d61a2e22a1e3f843fc8d71b690 inherit pub_attribs_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#ad57301d61a2e22a1e3f843fc8d71b690">$class_description</a></td></tr>
<tr class="separator:ad57301d61a2e22a1e3f843fc8d71b690 inherit pub_attribs_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0195e339191feef610d1cdf09af95d84 inherit pub_attribs_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a0195e339191feef610d1cdf09af95d84">$error</a></td></tr>
<tr class="separator:a0195e339191feef610d1cdf09af95d84 inherit pub_attribs_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a256ce7dee5ecb0146b3974a762f02795 inherit pub_attribs_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a256ce7dee5ecb0146b3974a762f02795">$table_name</a></td></tr>
<tr class="separator:a256ce7dee5ecb0146b3974a762f02795 inherit pub_attribs_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_a00304"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_a00304')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="a00304.html">A_CO_DB</a></td></tr>
<tr class="memitem:a6ff3c27bf8ac1bf1370aeeb6b7835d3c inherit pro_attribs_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#a6ff3c27bf8ac1bf1370aeeb6b7835d3c">$_pdo_object</a></td></tr>
<tr class="separator:a6ff3c27bf8ac1bf1370aeeb6b7835d3c inherit pro_attribs_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabeac345c845e7b7f481149b234641bb inherit pro_attribs_a00304"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00304.html#aabeac345c845e7b7f481149b234641bb">$_existing_record_objects</a></td></tr>
<tr class="separator:aabeac345c845e7b7f481149b234641bb inherit pro_attribs_a00304"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the instance class for the main "data" database. </p>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00038">38</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3a2aaf7151bd7cfe8eeffafe34e030d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a2aaf7151bd7cfe8eeffafe34e030d9">&#9670;&nbsp;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::__construct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_pdo_object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_access_object</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The initializer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_pdo_object</td><td>The PDO object for this database, initialized and ready. </td></tr>
    <tr><td class="paramname">$in_access_object</td><td>The access object for the database. If NULL, then no login. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="a00304.html#aca49137c323f216a6704087ad30b01f1">A_CO_DB</a>.</p>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00524">524</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                  {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        parent::__construct($in_pdo_object, $in_access_object);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        $this-&gt;table_name = <span class="stringliteral">&#39;co_data_nodes&#39;</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        $this-&gt;class_description = <span class="stringliteral">&#39;The main data database class.&#39;</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa97e6ad521aed4c2cbe03e83017af0b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa97e6ad521aed4c2cbe03e83017af0b7">&#9670;&nbsp;</a></span>_build_sql_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::_build_sql_query </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_search_parameters</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$or_search</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$page_size</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$initial_page</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$and_writeable</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$count_only</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ids_only</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This builds up an SQL query, based on the input from the user.</p>
<dl class="section return"><dt>Returns</dt><dd>an array of instances that match the search parameters. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_search_parameters</td><td>This is an associative array of terms to define the search. The keys should be:<ul>
<li>'id' This should be accompanied by an array of one or more integers, representing specific item IDs.</li>
<li>'access_class' This should be accompanied by an array, containing one or more PHP class names.</li>
<li>'name' This will contain a case-insensitive array of strings to check against the object_name column.</li>
<li>'owner' This should be accompanied by an array of one or more integers, representing specific item IDs for "owner" objects.</li>
<li>'tags' This should be accompanied by an array (up to 10 elements) of one or more case-insensitive strings, representing specific tag values.</li>
<li>'location' This requires that the parameter be a 3-element associative array of floating-point numbers:<ul>
<li>'longtude' This is the search center location longitude, in degrees.</li>
<li>'latitude' This is the search center location latitude, in degrees.</li>
<li>'radius' This is the search radius, in Kilometers. </li>
</ul>
</li>
</ul>
</td></tr>
    <tr><td class="paramname">$or_search</td><td>If true, then the search is very wide (OR), as opposed to narrow (AND), by default. If you specify a location, then that will always be AND, but the other fields can be OR. </td></tr>
    <tr><td class="paramname">$page_size</td><td>If specified with a 1-based integer, this denotes the size of a "page" of results. NOTE: This is only applicable to MySQL or Postgres, and will be ignored if the DB is not MySQL or Postgres. </td></tr>
    <tr><td class="paramname">$initial_page</td><td>This is ignored unless $page_size is greater than 0. If so, then this 0-based index will specify which page of results to return. </td></tr>
    <tr><td class="paramname">$and_writeable</td><td>If true, then we only want records we can modify. </td></tr>
    <tr><td class="paramname">$count_only</td><td>If true (default is false), then only a single integer will be returned, with the count of items that fit the search. </td></tr>
    <tr><td class="paramname">$ids_only</td><td>If true (default is false), then the return array will consist only of integers (the object IDs). If $count_only is true, this is ignored. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00421">421</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                                          {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        $ret = Array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; Array());</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        $closure = <span class="stringliteral">&#39;&#39;</span>;  <span class="comment">// This will be the suffix for the SQL.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        $location_search = <span class="keyword">false</span>;   <span class="comment">// We use this as a semaphore, so we don&#39;t shortcut location searches you can&#39;t refine to only IDs, because of the syntax of the SQL.</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        $link = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">// If we are doing a location/radius search, the predicate is a lot more complicated.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span> (isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>]) &amp;&amp; isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;longitude&#39;</span>]) &amp;&amp; isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;latitude&#39;</span>]) &amp;&amp; isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;radius&#39;</span>])) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="comment">// We expand the radius by 5%, because we&#39;ll be triaging the results with the more accurate Vincenty calculation afterwards.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            $predicate_temp = $this-&gt;<a class="code" href="a00312.html#a352444b4bfd455cb53a57137f3c44884">_location_predicate</a>($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;longitude&#39;</span>], $in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;latitude&#39;</span>], floatval($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;radius&#39;</span>]) * 1.02, $and_writeable, $count_only);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            $sql = $predicate_temp[<span class="stringliteral">&#39;sql&#39;</span>];</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            $ret[<span class="stringliteral">&#39;params&#39;</span>] = $predicate_temp[<span class="stringliteral">&#39;params&#39;</span>];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            $closure = $count_only ? <span class="charliteral">&#39;)&#39;</span> : <span class="stringliteral">&#39;) ORDER BY distance,id&#39;</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            $location_search = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            $link = <span class="stringliteral">&#39; AND &#39;</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            $predicate = $this-&gt;<a class="code" href="a00304.html#ad2356dbed1b38898d8c17bcd8eb405ef">_create_security_predicate</a>($and_writeable);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span> (!$predicate) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                $predicate = <span class="stringliteral">&#39;true&#39;</span>; <span class="comment">// If we are in &quot;God Mode,&quot; we could get no predicate, so we just go with &quot;1&quot;.</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            $sql = $count_only ? <span class="stringliteral">&#39;SELECT COUNT(*) FROM (&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            $sql .= <span class="stringliteral">&#39;SELECT * FROM &#39;</span>.$this-&gt;table_name.<span class="stringliteral">&#39; WHERE (&#39;</span>.$predicate.<span class="stringliteral">&#39; AND (&#39;</span>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            $closure = $count_only ? <span class="charliteral">&#39;)&#39;</span> : <span class="stringliteral">&#39;) ORDER BY id&#39;</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">// At this point, we have the &quot;prefix&quot; for the SQL query. That includes the security predicate, and any Haversine &quot;triage&quot; for location.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="comment">// We now add the actual parameters that specialize the search.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span> (isset($in_search_parameters) &amp;&amp; is_array($in_search_parameters) &amp;&amp; count($in_search_parameters)) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="comment">// This function will parse the parameters, and return an associative array with the SQL WHERE clause, along with the relevant parameters for the prepared statement.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            $param_ret = $this-&gt;<a class="code" href="a00312.html#a64a118564e4da8a3b0220ee5cf088e9b">_parse_parameters</a>($in_search_parameters, $or_search);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">if</span> ($param_ret[<span class="stringliteral">&#39;sql&#39;</span>]) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                $sql .= $link.$param_ret[<span class="stringliteral">&#39;sql&#39;</span>];</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="keywordflow">if</span> (count($param_ret[<span class="stringliteral">&#39;params&#39;</span>])) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    $ret[<span class="stringliteral">&#39;params&#39;</span>] = array_merge($ret[<span class="stringliteral">&#39;params&#39;</span>], $param_ret[<span class="stringliteral">&#39;params&#39;</span>]);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            $sql .= <span class="stringliteral">&#39;true&#39;</span>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        $closure = <span class="stringliteral">&quot;)$closure&quot;</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        $page_size = intval($page_size);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment">// This only applies for MySQL or Postgres.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> (0 &lt; $page_size) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            $initial_page = intval($initial_page);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            $start = $initial_page * $page_size;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="comment">// Slightly different syntax for MySQL and Postgres.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">if</span> ( ((<span class="stringliteral">&#39;mysql&#39;</span> == $this-&gt;_pdo_object-&gt;driver_type) || (<span class="stringliteral">&#39;mysqli&#39;</span> == $this-&gt;_pdo_object-&gt;driver_type))) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                $closure .= <span class="stringliteral">&#39; LIMIT &#39;</span>.$start.<span class="stringliteral">&#39;, &#39;</span>.$page_size;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            } elseif (<span class="stringliteral">&#39;pgsql&#39;</span> == $this-&gt;_pdo_object-&gt;driver_type) {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                $closure .= <span class="stringliteral">&#39; LIMIT &#39;</span>.$page_size.<span class="stringliteral">&#39; OFFSET &#39;</span>.$start;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> ($count_only) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            $closure .= <span class="stringliteral">&#39;) AS count&#39;</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        } elseif ($ids_only &amp;&amp; !$location_search) { <span class="comment">// IDs only, we simply ask for only the ID.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            $replacement = <span class="stringliteral">&#39;SELECT (id)&#39;</span>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            $sql = preg_replace(<span class="stringliteral">&#39;|^SELECT \*|&#39;</span>, $replacement, $sql);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        $ret[<span class="stringliteral">&#39;sql&#39;</span>] = $sql.$closure;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div>
<div class="ttc" id="aa00304_html_ad2356dbed1b38898d8c17bcd8eb405ef"><div class="ttname"><a href="a00304.html#ad2356dbed1b38898d8c17bcd8eb405ef">A_CO_DB\_create_security_predicate</a></div><div class="ttdeci">_create_security_predicate( $write=false)</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00167">a_co_db.class.php:167</a></div></div>
<div class="ttc" id="aa00312_html_a352444b4bfd455cb53a57137f3c44884"><div class="ttname"><a href="a00312.html#a352444b4bfd455cb53a57137f3c44884">CO_Main_Data_DB\_location_predicate</a></div><div class="ttdeci">_location_predicate( $in_longitude, $in_latitude, $in_radius_in_km, $and_writeable=false, $count_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00124">co_main_data_db.class.php:124</a></div></div>
<div class="ttc" id="aa00312_html_a64a118564e4da8a3b0220ee5cf088e9b"><div class="ttname"><a href="a00312.html#a64a118564e4da8a3b0220ee5cf088e9b">CO_Main_Data_DB\_parse_parameters</a></div><div class="ttdeci">_parse_parameters( $in_search_parameters=NULL, $or_search=false)</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00349">co_main_data_db.class.php:349</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00146_source.html#l00167">A_CO_DB\_create_security_predicate()</a>, <a class="el" href="a00152_source.html#l00124">_location_predicate()</a>, and <a class="el" href="a00152_source.html#l00349">_parse_parameters()</a>.</p>

<p class="reference">Referenced by <a class="el" href="a00152_source.html#l00650">generic_search()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00312_aa97e6ad521aed4c2cbe03e83017af0b7_cgraph.svg" width="100%" height="500"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_aa97e6ad521aed4c2cbe03e83017af0b7_icgraph.svg" width="419" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a352444b4bfd455cb53a57137f3c44884"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a352444b4bfd455cb53a57137f3c44884">&#9670;&nbsp;</a></span>_location_predicate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::_location_predicate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_longitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_latitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_radius_in_km</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$and_writeable</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$count_only</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method creates a special SQL header that has an embedded Haversine formula. You use this in place of the security predicate.</p>
<p>The Haversine formula is not as accurate as the Vincenty Calculation, but is a lot less computationally intense, so we use this in SQL for a "triage."</p>
<dl class="section return"><dt>Returns</dt><dd>an SQL query that will specify a Haversine search. It will include the security predicate. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_longitude</td><td>The search center longitude, in degrees. </td></tr>
    <tr><td class="paramname">$in_latitude</td><td>The search center latitude, in degrees. </td></tr>
    <tr><td class="paramname">$in_radius_in_km</td><td>The search radius, in Kilometers. </td></tr>
    <tr><td class="paramname">$and_writeable</td><td>If true, then we only want records we can modify. </td></tr>
    <tr><td class="paramname">$count_only</td><td>If true (default is false), then only a single integer will be returned, with the count of items that fit the search. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00124">124</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                              {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        $ret = Array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; Array());</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        $predicate = $this-&gt;<a class="code" href="a00304.html#ad2356dbed1b38898d8c17bcd8eb405ef">_create_security_predicate</a>($and_writeable);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span> (!$predicate) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            $predicate = <span class="stringliteral">&#39;true&#39;</span>; <span class="comment">// If we are in &quot;God Mode,&quot; we could get no predicate, so we just go with &quot;1&quot;.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        $ret[<span class="stringliteral">&#39;sql&#39;</span>] = $count_only ? <span class="stringliteral">&#39;SELECT COUNT(*) FROM (&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        $ret[<span class="stringliteral">&#39;sql&#39;</span>] .= <span class="stringliteral">&quot;SELECT * FROM (</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="stringliteral">                        SELECT z.*,</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral">                            p.radius,</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="stringliteral">                            p.distance_unit</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">                                     * DEGREES(ACOS(COS(RADIANS(p.latpoint))</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="stringliteral">                                     * COS(RADIANS(z.latitude))</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">                                     * COS(RADIANS(p.longpoint - z.longitude))</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">                                     + SIN(RADIANS(p.latpoint))</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral">                                     * SIN(RADIANS(z.latitude)))) AS distance</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">                        FROM &quot;</span>.$this-&gt;table_name.<span class="stringliteral">&quot; AS z</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral">                        JOIN (   /* these are the query parameters */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">                            SELECT  &quot;</span>.floatval($in_latitude).<span class="stringliteral">&quot;  AS latpoint,  &quot;</span>.floatval($in_longitude).<span class="stringliteral">&quot; AS longpoint,</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">                                    &quot;</span>.floatval($in_radius_in_km).<span class="stringliteral">&quot; AS radius,      111.045 AS distance_unit</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">                        ) AS p ON 1=1</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">                        WHERE z.latitude</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">                         BETWEEN p.latpoint  - (p.radius / p.distance_unit)</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">                             AND p.latpoint  + (p.radius / p.distance_unit)</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">                        AND z.longitude</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">                         BETWEEN p.longpoint - (p.radius / (p.distance_unit * COS(RADIANS(p.latpoint))))</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">                             AND p.longpoint + (p.radius / (p.distance_unit * COS(RADIANS(p.latpoint))))</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">                        ) AS d</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">                        WHERE ($predicate AND ((distance &lt;= radius)&quot;</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00146_source.html#l00167">A_CO_DB\_create_security_predicate()</a>.</p>

<p class="reference">Referenced by <a class="el" href="a00152_source.html#l00421">_build_sql_query()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_a352444b4bfd455cb53a57137f3c44884_cgraph.svg" width="652" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_a352444b4bfd455cb53a57137f3c44884_icgraph.svg" width="662" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a884b5749acdbc87467741bc6610794e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a884b5749acdbc87467741bc6610794e4">&#9670;&nbsp;</a></span>_parse_integer_parameter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::_parse_integer_parameter </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_db_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method will return an SQL statement and an empty set of parameters for an integer table column value.</p>
<dl class="section return"><dt>Returns</dt><dd>an SQL statement that acts as a WHERE clause for a integer. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_db_key</td><td>The table column name. </td></tr>
    <tr><td class="paramname">$in_value</td><td>The value </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00277">277</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                                  {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        $ret = Array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; Array());</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">if</span> (isset($in_value) &amp;&amp; is_array($in_value) &amp;&amp; count($in_value)) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            $in_value = array_unique(array_map(<span class="stringliteral">&#39;intval&#39;</span>, $in_value));    <span class="comment">// Make sure we don&#39;t have repeats.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            $sql_array = Array();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">foreach</span> ($in_value as $value) {                </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keywordflow">if</span> (NULL !== $value) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    $sql_array[] = strval($in_db_key).<span class="stringliteral">&#39;=?&#39;</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                    array_push($ret[<span class="stringliteral">&#39;params&#39;</span>], $value);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="charliteral">&#39;(&#39;</span>.implode(<span class="stringliteral">&#39;) OR (&#39;</span>, $sql_array).<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>.strval($in_db_key).<span class="stringliteral">&#39;=?&#39;</span>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            array_push($ret[<span class="stringliteral">&#39;params&#39;</span>], $in_value);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00152_source.html#l00349">_parse_parameters()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00312_a884b5749acdbc87467741bc6610794e4_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a64a118564e4da8a3b0220ee5cf088e9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64a118564e4da8a3b0220ee5cf088e9b">&#9670;&nbsp;</a></span>_parse_parameters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::_parse_parameters </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_search_parameters</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$or_search</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This parses the provided parameters, and returns a WHERE clause for them.</p>
<dl class="section return"><dt>Returns</dt><dd>an SQL statement that acts as a WHERE clause for the given parameters. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_search_parameters</td><td>This is an associative array of terms to define the search. The keys should be:<ul>
<li>'id' This should be accompanied by an array of one or more integers, representing specific item IDs.</li>
<li>'access_class' This should be accompanied by an array, containing one or more PHP class names (case-insensitive strings).</li>
<li>'name' This will contain a case-insensitive array of strings to check against the object_name column.</li>
<li>'owner' This should be accompanied by an array of one or more integers, representing specific item IDs for "owner" objects.</li>
<li>'tags' This should be accompanied by an array (up to 10 elements) of one or more case-insensitive strings, representing specific tag values. </li>
</ul>
</td></tr>
    <tr><td class="paramname">$or_search</td><td>If true, then the search is very wide (OR), as opposed to narrow (AND), by default. If you specify a location, then that will always be AND, but the other fields can be OR. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00349">349</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                          {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        $ret = Array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; Array());</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">if</span> (isset($in_search_parameters) &amp;&amp; is_array($in_search_parameters) &amp;&amp; count ($in_search_parameters)) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            $sql_array = Array();</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            $param_array = Array();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">foreach</span> ($in_search_parameters as $key =&gt; $value) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                $temp = NULL;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">switch</span> ($key) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;id&#39;</span>:</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        $temp = $this-&gt;<a class="code" href="a00312.html#a884b5749acdbc87467741bc6610794e4">_parse_integer_parameter</a>(<span class="stringliteral">&#39;id&#39;</span>, $value);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;access_class&#39;</span>:</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                        $temp = $this-&gt;<a class="code" href="a00312.html#a46a9af2d7f6fc1388608022c6b84662e">_parse_string_parameter</a>(<span class="stringliteral">&#39;access_class&#39;</span>, $value);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;name&#39;</span>:</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        $temp = $this-&gt;<a class="code" href="a00312.html#a46a9af2d7f6fc1388608022c6b84662e">_parse_string_parameter</a>(<span class="stringliteral">&#39;object_name&#39;</span>, $value);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;owner&#39;</span>:</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        $temp = $this-&gt;<a class="code" href="a00312.html#a884b5749acdbc87467741bc6610794e4">_parse_integer_parameter</a>(<span class="stringliteral">&#39;owner&#39;</span>, $value);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;tags&#39;</span>:</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                        $temp = $this-&gt;<a class="code" href="a00312.html#a49c326f37d274ac9f25171380c851164">_parse_tags</a>($value);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">if</span> (isset($temp) &amp;&amp; is_array($temp) &amp;&amp; count($temp)) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    $sql_array[] = $temp[<span class="stringliteral">&#39;sql&#39;</span>];</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    $ret[<span class="stringliteral">&#39;params&#39;</span>] = array_merge($ret[<span class="stringliteral">&#39;params&#39;</span>], $temp[<span class="stringliteral">&#39;params&#39;</span>]);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="keywordflow">if</span> (1 &lt; count($sql_array)) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                $link = $or_search ? <span class="stringliteral">&#39;) OR (&#39;</span> : <span class="stringliteral">&#39;) AND (&#39;</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;((&#39;</span>.implode($link, $sql_array).<span class="stringliteral">&#39;))&#39;</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            } elseif (count($sql_array)) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                $ret[<span class="stringliteral">&#39;sql&#39;</span>] = $sql_array[0];</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    }</div>
<div class="ttc" id="aa00312_html_a46a9af2d7f6fc1388608022c6b84662e"><div class="ttname"><a href="a00312.html#a46a9af2d7f6fc1388608022c6b84662e">CO_Main_Data_DB\_parse_string_parameter</a></div><div class="ttdeci">_parse_string_parameter( $in_db_key, $in_value)</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00309">co_main_data_db.class.php:309</a></div></div>
<div class="ttc" id="aa00312_html_a49c326f37d274ac9f25171380c851164"><div class="ttname"><a href="a00312.html#a49c326f37d274ac9f25171380c851164">CO_Main_Data_DB\_parse_tags</a></div><div class="ttdeci">_parse_tags( $in_value)</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00171">co_main_data_db.class.php:171</a></div></div>
<div class="ttc" id="aa00312_html_a884b5749acdbc87467741bc6610794e4"><div class="ttname"><a href="a00312.html#a884b5749acdbc87467741bc6610794e4">CO_Main_Data_DB\_parse_integer_parameter</a></div><div class="ttdeci">_parse_integer_parameter( $in_db_key, $in_value)</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00277">co_main_data_db.class.php:277</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00152_source.html#l00277">_parse_integer_parameter()</a>, <a class="el" href="a00152_source.html#l00309">_parse_string_parameter()</a>, and <a class="el" href="a00152_source.html#l00171">_parse_tags()</a>.</p>

<p class="reference">Referenced by <a class="el" href="a00152_source.html#l00421">_build_sql_query()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_a64a118564e4da8a3b0220ee5cf088e9b_cgraph.svg" width="454" height="170"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_a64a118564e4da8a3b0220ee5cf088e9b_icgraph.svg" width="648" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a46a9af2d7f6fc1388608022c6b84662e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46a9af2d7f6fc1388608022c6b84662e">&#9670;&nbsp;</a></span>_parse_string_parameter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::_parse_string_parameter </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_db_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method will return an SQL statement and a set of parameters for a case-insensitive string table column value.</p>
<dl class="section return"><dt>Returns</dt><dd>an SQL statement that acts as a WHERE clause for a string. </dd></dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00309">309</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                                  {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        $ret = Array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; Array());</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> (isset($in_value) &amp;&amp; is_array($in_value) &amp;&amp; count($in_value)) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            $use_like = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordflow">if</span> (isset($in_value[<span class="stringliteral">&#39;use_like&#39;</span>])) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                $use_like = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                unset($in_value[<span class="stringliteral">&#39;use_like&#39;</span>]);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            $in_value = array_unique(array_map(<span class="keyword">function</span>($in){<span class="keywordflow">return</span> strtolower(trim(strval($in)));}, $in_value));    <span class="comment">// Make sure we don&#39;t have repeats.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            $sql_array = Array();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordflow">foreach</span> ($in_value as $value) {                </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">if</span> ((NULL != $value) &amp;&amp; (<span class="charliteral">&#39;%&#39;</span> != $value)) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    $sql_array[] = <span class="stringliteral">&#39;LOWER(&#39;</span>.strval($in_db_key).<span class="charliteral">&#39;)&#39;</span>.($use_like ? <span class="stringliteral">&#39; LIKE &#39;</span> : <span class="charliteral">&#39;=&#39;</span>).<span class="stringliteral">&#39;LOWER(?)&#39;</span>;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    array_push($ret[<span class="stringliteral">&#39;params&#39;</span>], $value);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                } elseif (<span class="charliteral">&#39;%&#39;</span> == $value) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    $sql_array[] = <span class="charliteral">&#39;(&#39;</span>.strval($in_db_key).<span class="stringliteral">&#39;&lt;&gt;\&#39;\&#39;)&#39;</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;((&#39;</span>.implode(<span class="stringliteral">&#39;) OR (&#39;</span>, $sql_array).<span class="stringliteral">&#39;))&#39;</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;LOWER(&#39;</span>.strval($in_db_key).<span class="stringliteral">&#39;)=LOWER(?)&#39;</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            $ret[<span class="stringliteral">&#39;params&#39;</span>][0] = $in_value;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00152_source.html#l00349">_parse_parameters()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00312_a46a9af2d7f6fc1388608022c6b84662e_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a49c326f37d274ac9f25171380c851164"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49c326f37d274ac9f25171380c851164">&#9670;&nbsp;</a></span>_parse_tags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::_parse_tags </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method will return an SQL statement and a set of parameters for the tags.</p>
<dl class="section return"><dt>Returns</dt><dd>an SQL statement that acts as a WHERE clause for the tags. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_value</td><td>This should be an array of string. You can provide just one string, but that will always be applied to tag0. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00171">171</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                      {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        $ret = Array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; Array());</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">if</span> (isset($in_value) &amp;&amp; is_array($in_value) &amp;&amp; count($in_value)) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            $use_like = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">if</span> (isset($in_value[<span class="stringliteral">&#39;use_like&#39;</span>])) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                $use_like = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                unset($in_value[<span class="stringliteral">&#39;use_like&#39;</span>]);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            $sql_temp = Array();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">for</span> ($i = 0; $i &lt; count($in_value); $i++) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                $sql_temp[$i] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                $value = $in_value[$i];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">if</span> ((NULL !== $value) &amp;&amp; (<span class="charliteral">&#39;%&#39;</span> != $value)) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                    <span class="keywordflow">if</span> (is_array($value) &amp;&amp; count($value)) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                        $use_like_old = $use_like;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                        </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                        <span class="keywordflow">if</span> (isset($value[<span class="stringliteral">&#39;use_like&#39;</span>])) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                            $use_like = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                            unset($value[<span class="stringliteral">&#39;use_like&#39;</span>]);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                        </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                        $inner_array = Array();</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                        <span class="keywordflow">foreach</span> ($value as $val) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                            <span class="keywordflow">if</span> (NULL != $val) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                $val = trim(strval($val));</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $val) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                    $inner_array[] = <span class="stringliteral">&#39;((tag&#39;</span>.intval($i).<span class="stringliteral">&#39; IS NULL) OR (tag&#39;</span>.intval($i).<span class="stringliteral">&#39;=\&#39;\&#39;))&#39;</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                } elseif (<span class="charliteral">&#39;%&#39;</span> == $val) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                    $inner_array[] = <span class="stringliteral">&#39;(tag&#39;</span>.intval($i).<span class="stringliteral">&#39;&lt;&gt;\&#39;\&#39;)&#39;</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                    $like_me = (<span class="keyword">false</span> !== strpos($val, <span class="charliteral">&#39;%&#39;</span>)) &amp;&amp; $use_like;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                    $inner_array[] = <span class="stringliteral">&#39;LOWER(tag&#39;</span>.intval($i).<span class="charliteral">&#39;)&#39;</span>.($like_me ? <span class="stringliteral">&#39; LIKE &#39;</span> : <span class="charliteral">&#39;=&#39;</span>).<span class="stringliteral">&#39;LOWER(?)&#39;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                    array_push($ret[<span class="stringliteral">&#39;params&#39;</span>], $val);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                            }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                        <span class="keywordflow">if</span> (1 &lt; count($inner_array)) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                            $sql_temp[$i] = <span class="charliteral">&#39;(&#39;</span>.implode(<span class="stringliteral">&#39;) OR (&#39;</span>, $inner_array).<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        } elseif (count($inner_array)) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                            $sql_temp[$i] = $inner_array[0];</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                        }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                        </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                        $use_like = $use_like_old;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                        <span class="keywordflow">if</span> (NULL !== $value) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                            $value = trim(strval($value));</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                            <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $value) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                $sql_temp[$i] = <span class="stringliteral">&#39;((tag&#39;</span>.intval($i).<span class="stringliteral">&#39; IS NULL) OR (tag&#39;</span>.intval($i).<span class="stringliteral">&#39;=\&#39;\&#39;))&#39;</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                $like_me = (<span class="keyword">false</span> !== strpos($value, <span class="charliteral">&#39;%&#39;</span>)) &amp;&amp; $use_like;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                $sql_temp[$i] = <span class="stringliteral">&#39;LOWER(tag&#39;</span>.intval($i).<span class="charliteral">&#39;)&#39;</span>.($like_me ? <span class="stringliteral">&#39; LIKE &#39;</span> : <span class="charliteral">&#39;=&#39;</span>).<span class="stringliteral">&#39;LOWER(?)&#39;</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                array_push($ret[<span class="stringliteral">&#39;params&#39;</span>], strval($value));</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                            }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                } elseif (<span class="charliteral">&#39;%&#39;</span> == $value) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    $sql_temp[$i] = <span class="stringliteral">&#39;(tag&#39;</span>.intval($i).<span class="stringliteral">&#39;&lt;&gt;\&#39;\&#39;)&#39;</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            $temp_array = Array();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="comment">// Can&#39;t just do an array_filter, because PHP likes to keep the filtered elements at their original indexes.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">foreach</span> ($sql_temp as $array_element) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> != $array_element) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    array_push($temp_array, $array_element);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">if</span> (1 &lt; count($temp_array)) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;((&#39;</span>.implode(<span class="stringliteral">&#39;) AND (&#39;</span>, $temp_array).<span class="stringliteral">&#39;))&#39;</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            } elseif (1 == count($temp_array)) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                $ret[<span class="stringliteral">&#39;sql&#39;</span>] = $temp_array[0];</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            $in_value = trim(strval($in_value));</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">if</span> (NULL !== $in_value) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $in_value) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;((tag0 IS NULL) OR (tag0=\&#39;\&#39;))&#39;</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    $like_me = (<span class="keyword">false</span> !== strpos($in_value, <span class="charliteral">&#39;%&#39;</span>)) &amp;&amp; $use_like;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                    $ret[<span class="stringliteral">&#39;sql&#39;</span>] = <span class="stringliteral">&#39;(LOWER(tag0)&#39;</span>.($like_me ? <span class="stringliteral">&#39; LIKE &#39;</span> : <span class="charliteral">&#39;=&#39;</span>).<span class="stringliteral">&#39;LOWER(?))&#39;</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                    array_push($ret[<span class="stringliteral">&#39;params&#39;</span>], strval($value));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00152_source.html#l00349">_parse_parameters()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00312_a49c326f37d274ac9f25171380c851164_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a303048d406814c066d27fda70de4ff02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a303048d406814c066d27fda70de4ff02">&#9670;&nbsp;</a></span>generic_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::generic_search </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_search_parameters</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$or_search</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$page_size</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$initial_page</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$and_writeable</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$count_only</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ids_only</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is a "generic" data database search. It can be called from external user contexts, and allows a fairly generalized search of the "data" database. Sorting will be done for the values by the ID of the searched objects. "location" will be by distance from the center.</p>
<dl class="section return"><dt>Returns</dt><dd>an array of instances that match the search parameters. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_search_parameters</td><td>This is an associative array of terms to define the search. The keys should be:<ul>
<li>'id' This should be accompanied by an array of one or more integers, representing specific item IDs.</li>
<li>'access_class' This should be accompanied by an array, containing one or more PHP class names.</li>
<li>'name' This will contain a case-insensitive array of strings to check against the object_name column.</li>
<li>'owner' This should be accompanied by an array of one or more integers, representing specific item IDs for "owner" objects.</li>
<li>'tags' This should be accompanied by an array (up to 10 elements) of one or more case-insensitive strings, representing specific tag values. The position in the array denotes which tag to match, so unchecked tags should still be in the array, but empty. You don't match empty tags. You can specify an array for the values, which allows you to do an OR search for the values.</li>
<li>'location' This is only relevant if we are searching for subclasses (or instances) of <a class="el" href="a00332.html">CO_LL_Location</a> This requires that the parameter be a 3-element associative array of floating-point numbers:<ul>
<li>'longitude' This is the search center location longitude, in degrees.</li>
<li>'latitude' This is the search center location latitude, in degrees.</li>
<li>'radius' This is the search radius, in Kilometers.</li>
</ul>
</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<p>You can specify an array for any one of the values, which allows you to do an OR search for those values ($or_search does not apply. It is only for the combination of main values). If you add an element called 'use_like' ('use_like' =&gt; 1) to the end of 'access_class', 'name' or one of the 'tags', then you can use SQL-style "wildcards" (%) in your matches. If you have 'use_like', and put just a single wildcard in quotes (''), then you are saying "not-empty." NOTE: Although this is an optional parameter, failing to provide anything could return the entire readable database. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$or_search</td><td>If true, then the search is very wide (OR), as opposed to narrow (AND), by default. If you specify a location, then that will always be AND, but the other fields can be OR. </td></tr>
    <tr><td class="paramname">$page_size</td><td>If specified with a 1-based integer, this denotes the size of a "page" of results. NOTE: This is only applicable to MySQL or Postgres, and will be ignored if the DB is not MySQL or Postgres. </td></tr>
    <tr><td class="paramname">$initial_page</td><td>This is ignored unless $page_size is greater than 0. If so, then this 0-based index will specify which page of results to return. </td></tr>
    <tr><td class="paramname">$and_writeable</td><td>If true, then we only want records we can modify. </td></tr>
    <tr><td class="paramname">$count_only</td><td>If true (default is false), then only a single integer will be returned, with the count of items that fit the search. </td></tr>
    <tr><td class="paramname">$ids_only</td><td>If true (default is false), then the return array will consist only of integers (the object IDs). If $count_only is true, this is ignored. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00650">650</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                      {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        $ret = NULL;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="comment">// These are semaphores that we&#39;ll consult when the dust settles.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        $location_count = $count_only;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        $location_ids_only = $ids_only;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        $location_search = (isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>]) &amp;&amp; isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;longitude&#39;</span>]) &amp;&amp; isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;latitude&#39;</span>]) &amp;&amp; isset($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;radius&#39;</span>]));</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keywordflow">if</span> ($location_search) { <span class="comment">// We&#39;re forced to use the regular search for count-only and IDs location, as we need that Vincenty filter.</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            $count_only = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            $ids_only = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        $sql_and_params = $this-&gt;<a class="code" href="a00312.html#aa97e6ad521aed4c2cbe03e83017af0b7">_build_sql_query</a>($in_search_parameters, $or_search, $page_size, $initial_page, $and_writeable, $count_only, $ids_only);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        $sql = $sql_and_params[<span class="stringliteral">&#39;sql&#39;</span>];</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        $params = $sql_and_params[<span class="stringliteral">&#39;params&#39;</span>];</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">if</span> ($sql) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            $temp = $this-&gt;<a class="code" href="a00304.html#a2396849660aa4ff018ab7509a4badeb5">execute_query</a>($sql, $params);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">// Commented out, but useful for debugging.</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">// echo(&#39;SQL:&lt;pre&gt;&#39;.htmlspecialchars(print_r($sql, true)).&#39;&lt;/pre&gt;&#39;);</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">// echo(&#39;PARAMS:&lt;pre&gt;&#39;.htmlspecialchars(print_r($params, true)).&#39;&lt;/pre&gt;&#39;);</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">// echo(&#39;RESULT:&lt;pre&gt;&#39;.htmlspecialchars(print_r($temp, true)).&#39;&lt;/pre&gt;&#39;);</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordflow">if</span> (isset($temp) &amp;&amp; $temp &amp;&amp; is_array($temp) &amp;&amp; count($temp) ) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                <span class="keywordflow">if</span> ($count_only) {  <span class="comment">// Different syntax for MySQL and Postgres</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    <span class="keywordflow">if</span> (isset($temp[0][<span class="stringliteral">&#39;count(*)&#39;</span>])) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        $ret = intval($temp[0][<span class="stringliteral">&#39;count(*)&#39;</span>]);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                        <span class="keywordflow">if</span> (isset($temp[0][<span class="stringliteral">&#39;count&#39;</span>])) {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                            $ret = intval($temp[0][<span class="stringliteral">&#39;count&#39;</span>]);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                        }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                    }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                    $ret = Array();</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                    <span class="keywordflow">foreach</span> ($temp as $result) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                        $result = $ids_only ? intval($result[<span class="stringliteral">&#39;id&#39;</span>]) : $this-&gt;<a class="code" href="a00304.html#a523e2f40174a0bca0fc873d6286b3ae9">_instantiate_record</a>($result);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                        <span class="keywordflow">if</span> ($result) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                            array_push($ret, $result);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                        }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                    }</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    <span class="comment">// If we do a distance search, then we filter and sort the results with the more accurate Vincenty algorithm, and we also give each record a &quot;distance&quot; parameter.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                    <span class="keywordflow">if</span> ($location_search) {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        $ret_temp = Array();</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        $count = 0;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                        </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                        <span class="keywordflow">foreach</span> ($ret as $item) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                            $latitude = floatval($item-&gt;raw_latitude());    <span class="comment">// This allows logins with the rights to see accurate locations an accurate response.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                            $longitude = floatval($item-&gt;raw_longitude());</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                            </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                            $accurate_distance = <a class="code" href="a00312.html#ae11526b802f2277322e001bc2d45094b">self::get_accurate_distance</a>(floatval($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;latitude&#39;</span>]), floatval($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;longitude&#39;</span>]), $latitude, $longitude);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                            <span class="keywordflow">if</span> ($accurate_distance &lt;= floatval($in_search_parameters[<span class="stringliteral">&#39;location&#39;</span>][<span class="stringliteral">&#39;radius&#39;</span>])) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                $item-&gt;distance = $accurate_distance;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                                array_push($ret_temp, $item);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                                $count++;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                            }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                        <span class="keywordflow">if</span> ($location_count) {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                            $ret_temp = $count;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                            usort($ret_temp, <span class="keyword">function</span>($a, $b){<span class="keywordflow">return</span> ($a-&gt;distance &gt; $b-&gt;distance);});</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                        </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                            <span class="keywordflow">if</span> ($location_ids_only) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                $ret_temp = array_map(<span class="keyword">function</span>($in_item) { <span class="keywordflow">return</span> $in_item-&gt;id(); }, $ret_temp);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                            }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                        }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        $ret = $ret_temp;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                    }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    } </div>
<div class="ttc" id="aa00304_html_a2396849660aa4ff018ab7509a4badeb5"><div class="ttname"><a href="a00304.html#a2396849660aa4ff018ab7509a4badeb5">A_CO_DB\execute_query</a></div><div class="ttdeci">execute_query( $in_sql, $in_parameters=NULL, $exec_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00292">a_co_db.class.php:292</a></div></div>
<div class="ttc" id="aa00304_html_a523e2f40174a0bca0fc873d6286b3ae9"><div class="ttname"><a href="a00304.html#a523e2f40174a0bca0fc873d6286b3ae9">A_CO_DB\_instantiate_record</a></div><div class="ttdeci">_instantiate_record( $in_db_result)</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00181">a_co_db.class.php:181</a></div></div>
<div class="ttc" id="aa00312_html_aa97e6ad521aed4c2cbe03e83017af0b7"><div class="ttname"><a href="a00312.html#aa97e6ad521aed4c2cbe03e83017af0b7">CO_Main_Data_DB\_build_sql_query</a></div><div class="ttdeci">_build_sql_query( $in_search_parameters=NULL, $or_search=false, $page_size=0, $initial_page=0, $and_writeable=false, $count_only=false, $ids_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00421">co_main_data_db.class.php:421</a></div></div>
<div class="ttc" id="aa00312_html_ae11526b802f2277322e001bc2d45094b"><div class="ttname"><a href="a00312.html#ae11526b802f2277322e001bc2d45094b">CO_Main_Data_DB\get_accurate_distance</a></div><div class="ttdeci">static get_accurate_distance( $lat1, $lon1, $lat2, $lon2)</div><div class="ttdoc">Uses the Vincenty calculation to determine the distance (in Kilometers) between the two given lat/lon...</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00050">co_main_data_db.class.php:50</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00152_source.html#l00421">_build_sql_query()</a>, <a class="el" href="a00146_source.html#l00181">A_CO_DB\_instantiate_record()</a>, <a class="el" href="a00146_source.html#l00292">A_CO_DB\execute_query()</a>, and <a class="el" href="a00152_source.html#l00050">get_accurate_distance()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="a00312_a303048d406814c066d27fda70de4ff02_cgraph.svg" width="100%" height="544"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ae11526b802f2277322e001bc2d45094b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae11526b802f2277322e001bc2d45094b">&#9670;&nbsp;</a></span>get_accurate_distance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static CO_Main_Data_DB::get_accurate_distance </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lat1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lon1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lat2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lon2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Uses the Vincenty calculation to determine the distance (in Kilometers) between the two given lat/long pairs (in Degrees). </p>
<p>The Vincenty calculation is more accurate than the Haversine calculation, as it takes into account the "un-spherical" shape of the Earth, but is more computationally intense. We use this calculation to refine the Haversine "triage" in SQL.</p>
<dl class="section return"><dt>Returns</dt><dd>a Float with the distance, in Kilometers. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$lat1</td><td>This is the first point latitude (degrees). </td></tr>
    <tr><td class="paramname">$lon1</td><td>This is the first point longitude (degrees). </td></tr>
    <tr><td class="paramname">$lat2</td><td>This is the second point latitude (degrees). </td></tr>
    <tr><td class="paramname">$lon2</td><td>This is the second point longitude (degrees). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00050">50</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordflow">if</span> (($lat1 == $lat2) &amp;&amp; ($lon1 == $lon2)) { <span class="comment">// Just a quick shortcut.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        $a = 6378137;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        $b = 6356752.3142;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        $f = 1/298.257223563;  <span class="comment">// WGS-84 ellipsiod</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        $L = ($lon2-$lon1)/57.2957795131;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        $U1 = atan((1.0-$f) * tan($lat1/57.2957795131));</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        $U2 = atan((1.0-$f) * tan($lat2/57.2957795131));</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        $sinU1 = sin($U1);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        $cosU1 = cos($U1);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        $sinU2 = sin($U2);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        $cosU2 = cos($U2);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;          </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        $lambda = $L;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        $lambdaP = $L;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        $iterLimit = 100;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            $sinLambda = sin($lambda);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            $cosLambda = cos($lambda);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            $sinSigma = sqrt(($cosU2*$sinLambda) * ($cosU2*$sinLambda) + ($cosU1*$sinU2-$sinU1*$cosU2*$cosLambda) * ($cosU1*$sinU2-$sinU1*$cosU2*$cosLambda));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="keywordflow">if</span> ($sinSigma==0) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                <span class="keywordflow">return</span> 0;  <span class="comment">// co-incident points</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            $cosSigma = $sinU1*$sinU2 + ($cosU1*$cosU2*$cosLambda);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            $sigma = atan2($sinSigma, $cosSigma);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            $sinAlpha = ($cosU1 * $cosU2 * $sinLambda) / $sinSigma;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            $cosSqAlpha = 1.0 - $sinAlpha*$sinAlpha;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">if</span> (0 == $cosSqAlpha) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            $cos2SigmaM = $cosSigma - 2.0*$sinU1*$sinU2/$cosSqAlpha;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            $divisor = (16.0*$cosSqAlpha*(4.0+$f*(4.0-3.0*$cosSqAlpha)));</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keywordflow">if</span> (0 == $divisor) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            $C = $f/$divisor;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            $lambdaP = $lambda;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            $lambda = $L + (1.0-$C) * $f * $sinAlpha * ($sigma + $C*$sinSigma*($cos2SigmaM+$C*$cosSigma*(-1.0+2.0*$cos2SigmaM*$cos2SigmaM)));</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        } <span class="keywordflow">while</span> (abs($lambda-$lambdaP) &gt; 1e-12 &amp;&amp; --$iterLimit&gt;0);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        $uSq = $cosSqAlpha * ($a*$a - $b*$b) / ($b*$b);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        $A = 1.0 + $uSq/16384.0*(4096.0+$uSq*(-768.0+$uSq*(320.0-175.0*$uSq)));</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        $B = $uSq/1024.0 * (256.0+$uSq*(-128.0+$uSq*(74.0-47.0*$uSq)));</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        $deltaSigma = $B*$sinSigma*($cos2SigmaM+$B/4.0*($cosSigma*(-1.0+2.0*$cos2SigmaM*$cos2SigmaM)-$B/6.0*$cos2SigmaM*(-3.0+4.0*$sinSigma*$sinSigma)*(-3.0+4.0*$cos2SigmaM*$cos2SigmaM)));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        $s = $b*$A*($sigma-$deltaSigma);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">return</span> ( abs ( round ( $s ) / 1000.0 ) ); </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00167_source.html#l00082">CO_LL_Location\_km_per_degree()</a>, and <a class="el" href="a00152_source.html#l00650">generic_search()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_ae11526b802f2277322e001bc2d45094b_icgraph.svg" width="403" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad5f95b226e01879bbee99a65b33cb12b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5f95b226e01879bbee99a65b33cb12b">&#9670;&nbsp;</a></span>get_all_visible_users()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::get_all_visible_users </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is an extremely simple function that gets the ID and name (usually the display name) of user instances visible to the current login. It's goal is to be extremely fast and result in a relatively small response.</p>
<dl class="section return"><dt>Returns</dt><dd>an associative array (if users are found) of (id =&gt; name) </dd></dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00575">575</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                                            {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        $ret = array();</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        $sql = <span class="stringliteral">&#39;SELECT id,object_name FROM &#39;</span>.$this-&gt;table_name.<span class="stringliteral">&#39; WHERE&#39;</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        $predicate = $this-&gt;<a class="code" href="a00304.html#a176b2c663fa7768e95e4fbe93281adc6">_create_read_security_predicate</a>();</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">if</span> ($predicate) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            $sql = <span class="stringliteral">&quot;$sql $predicate AND&quot;</span>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        $sql = <span class="stringliteral">&quot;$sql access_class=&#39;CO_User_Collection&#39;&quot;</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        $temp = $this-&gt;<a class="code" href="a00304.html#a2396849660aa4ff018ab7509a4badeb5">execute_query</a>($sql, Array());</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">if</span> (isset($temp) &amp;&amp; $temp &amp;&amp; is_array($temp) &amp;&amp; count($temp) ) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordflow">foreach</span>($temp as $value) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                $ret[$value[<span class="stringliteral">&quot;id&quot;</span>]] = $value[<span class="stringliteral">&quot;object_name&quot;</span>];</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div>
<div class="ttc" id="aa00304_html_a176b2c663fa7768e95e4fbe93281adc6"><div class="ttname"><a href="a00304.html#a176b2c663fa7768e95e4fbe93281adc6">A_CO_DB\_create_read_security_predicate</a></div><div class="ttdeci">_create_read_security_predicate()</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00104">a_co_db.class.php:104</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00146_source.html#l00104">A_CO_DB\_create_read_security_predicate()</a>, and <a class="el" href="a00146_source.html#l00292">A_CO_DB\execute_query()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_ad5f95b226e01879bbee99a65b33cb12b_cgraph.svg" width="620" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aad50ae8e57d81015ec1e8601dd2eaba4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad50ae8e57d81015ec1e8601dd2eaba4">&#9670;&nbsp;</a></span>item_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::item_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_visibility_test</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is a very "raw" function that simply checks to see if any item exists for a given integer ID.</p>
<p>This (usually) deliberately does not pass security vetting, so we're careful. It's meant to be used by collection classes for garbage collection.</p>
<dl class="section return"><dt>Returns</dt><dd>true, if an item exists for the given ID (if $in_visibility_test is set to true, then the item also has to be visible for reading by the user. Otherwise, you get true, whether or not the user can see it). </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_id</td><td>The ID of the item. </td></tr>
    <tr><td class="paramname">$in_visibility_test</td><td>If true (default is false), then this will return false, even if the item exists, but cannot be seen by this user. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00542">542</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                  {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        $ret = NULL;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        $sql = <span class="stringliteral">&#39;SELECT id FROM &#39;</span>.$this-&gt;table_name.<span class="stringliteral">&#39; WHERE &#39;</span>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">if</span> ($in_visibility_test) {  <span class="comment">// If we are only testing visibility, then we add a read security predicate.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            $predicate = $this-&gt;<a class="code" href="a00304.html#a176b2c663fa7768e95e4fbe93281adc6">_create_read_security_predicate</a>();</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="keywordflow">if</span> ($predicate) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                $sql = <span class="stringliteral">&quot;$sql$predicate AND &quot;</span>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="comment">// User collections work by having the login ID in tag 0, so we search for any collection records that have a tag 0 set to our login ID. Chances are good it&#39;s a user.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        $sql .= <span class="stringliteral">&#39;id=&#39;</span>.intval($in_id);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        $temp = $this-&gt;<a class="code" href="a00304.html#a2396849660aa4ff018ab7509a4badeb5">execute_query</a>($sql, Array());</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">if</span> (isset($temp) &amp;&amp; $temp &amp;&amp; is_array($temp) &amp;&amp; count($temp) ) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            $ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00146_source.html#l00104">A_CO_DB\_create_read_security_predicate()</a>, and <a class="el" href="a00146_source.html#l00292">A_CO_DB\execute_query()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="a00312_aad50ae8e57d81015ec1e8601dd2eaba4_cgraph.svg" width="627" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab72e9d50a3ba59e898ac589bd0ca9efd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72e9d50a3ba59e898ac589bd0ca9efd">&#9670;&nbsp;</a></span>see_if_user_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::see_if_user_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_login_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is a very "raw" function that simply checks to see if a user collection exists for a given login ID.</p>
<p>This deliberately does not pass security vetting, so we're careful.</p>
<dl class="section return"><dt>Returns</dt><dd>true, if a user exists for the given login ID. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_login_id</td><td>The login ID of the user. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00605">605</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                      {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        $ret = NULL;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="comment">// User collections work by having the login ID in tag 0, so we search for any collection records that have a tag 0 set to our login ID. Chances are good it&#39;s a user.</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        $sql = <span class="stringliteral">&#39;SELECT * FROM &#39;</span>.$this-&gt;table_name.<span class="stringliteral">&#39; WHERE (access_class LIKE \&#39;%_User_Collection\&#39;) AND (tag0=\&#39;&#39;</span>.intval($in_login_id).<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="stringliteral">        $temp = $this-&gt;execute_query($sql, Array($in_login_id));</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="stringliteral">        if (isset($temp) &amp;&amp; $temp &amp;&amp; is_array($temp) &amp;&amp; count($temp) ) {</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="stringliteral">            // We instantiate, as opposed to check the access_class, because we want to give the implementation the option of subclassing.</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral">            $result = $this-&gt;_instantiate_record($temp[0]);</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral">            if ($result instanceof CO_User_Collection) {    // This will crash if we aren&#39;</span>t looking at it from a CHAMELEON (at least) level. That<span class="stringliteral">&#39;s good.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral">                $ret = true;</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">            }</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral">        }</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">        return $ret;</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">    }</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a10fdab7b5236d7f970f54ebc19a1862c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10fdab7b5236d7f970f54ebc19a1862c">&#9670;&nbsp;</a></span>tag0_is_unique()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CO_Main_Data_DB::tag0_is_unique </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_tag0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$in_classname</em> = <code>'<a class="el" href="a00252.html">CO_KeyValue_CO_Collection</a>'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true, if the tag1 is unique in the DB (regardless of whether or not we can see it). </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$in_tag0</td><td>The key to test (a string). </td></tr>
    <tr><td class="paramname">$in_classname</td><td>This is the class to search for the key. The default is the base class. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00152_source.html#l00628">628</a> of file <a class="el" href="a00152_source.html">co_main_data_db.class.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                      {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        $ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        $sql = <span class="stringliteral">&#39;SELECT id FROM &#39;</span>.$this-&gt;table_name.<span class="stringliteral">&#39; WHERE (access_class=?) AND (tag0=?)&#39;</span>;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        $params = [$in_classname, $in_tag0];</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        $temp = $this-&gt;<a class="code" href="a00304.html#a2396849660aa4ff018ab7509a4badeb5">execute_query</a>($sql, $params);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">if</span> (isset($temp) &amp;&amp; $temp &amp;&amp; is_array($temp) &amp;&amp; count($temp) ) {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            $ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">return</span> $ret;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
